import { Queue } from 'bullmq';
import { PrismaService } from '../../../common/prisma.service';
import { SendMessageDto, ScheduleMessageDto, MessageFilterDto } from '../dto';
export declare class MessageService {
    private prisma;
    private emailQueue;
    private whatsappQueue;
    private smsQueue;
    constructor(prisma: PrismaService, emailQueue: Queue, whatsappQueue: Queue, smsQueue: Queue);
    private determineQueue;
    findAll(tenantId: string, filters: MessageFilterDto): Promise<{
        items: {
            subject: string | null;
            body: string;
            id: string;
            createdAt: Date;
            updatedAt: Date;
            metadata: import("@prisma/client/runtime/library").JsonValue | null;
            tenantId: string;
            status: import("@prisma/client").$Enums.MessageStatus;
            externalId: string | null;
            retryCount: number;
            channel: import("@prisma/client").$Enums.Channel;
            recipientType: import("@prisma/client").$Enums.RecipientType;
            recipientId: string;
            templateId: string | null;
            scheduledFor: Date | null;
            recipientEmail: string | null;
            recipientPhone: string | null;
            sentAt: Date | null;
            deliveredAt: Date | null;
            readAt: Date | null;
            failedAt: Date | null;
        }[];
        total: number;
        page: number;
        limit: number;
        totalPages: number;
    }>;
    findOne(tenantId: string, id: string): Promise<{
        subject: string | null;
        body: string;
        id: string;
        createdAt: Date;
        updatedAt: Date;
        metadata: import("@prisma/client/runtime/library").JsonValue | null;
        tenantId: string;
        status: import("@prisma/client").$Enums.MessageStatus;
        externalId: string | null;
        retryCount: number;
        channel: import("@prisma/client").$Enums.Channel;
        recipientType: import("@prisma/client").$Enums.RecipientType;
        recipientId: string;
        templateId: string | null;
        scheduledFor: Date | null;
        recipientEmail: string | null;
        recipientPhone: string | null;
        sentAt: Date | null;
        deliveredAt: Date | null;
        readAt: Date | null;
        failedAt: Date | null;
    }>;
    send(tenantId: string, dto: SendMessageDto, userId?: string): Promise<{
        subject: string | null;
        body: string;
        id: string;
        createdAt: Date;
        updatedAt: Date;
        metadata: import("@prisma/client/runtime/library").JsonValue | null;
        tenantId: string;
        status: import("@prisma/client").$Enums.MessageStatus;
        externalId: string | null;
        retryCount: number;
        channel: import("@prisma/client").$Enums.Channel;
        recipientType: import("@prisma/client").$Enums.RecipientType;
        recipientId: string;
        templateId: string | null;
        scheduledFor: Date | null;
        recipientEmail: string | null;
        recipientPhone: string | null;
        sentAt: Date | null;
        deliveredAt: Date | null;
        readAt: Date | null;
        failedAt: Date | null;
    }>;
    schedule(tenantId: string, dto: ScheduleMessageDto, userId?: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        status: import("@prisma/client").$Enums.ScheduleStatus;
        createdById: string | null;
        payload: import("@prisma/client/runtime/library").JsonValue;
        jobId: string | null;
        channel: import("@prisma/client").$Enums.Channel;
        recipientType: import("@prisma/client").$Enums.RecipientType;
        recipientId: string;
        templateId: string | null;
        scheduledFor: Date;
    }>;
    cancelScheduled(tenantId: string, id: string): Promise<{
        id: string;
        createdAt: Date;
        updatedAt: Date;
        tenantId: string;
        status: import("@prisma/client").$Enums.ScheduleStatus;
        createdById: string | null;
        payload: import("@prisma/client/runtime/library").JsonValue;
        jobId: string | null;
        channel: import("@prisma/client").$Enums.Channel;
        recipientType: import("@prisma/client").$Enums.RecipientType;
        recipientId: string;
        templateId: string | null;
        scheduledFor: Date;
    }>;
    private retryRateLimits;
    private readonly RETRY_LIMIT_PER_MESSAGE;
    private readonly RETRY_LIMIT_PER_TENANT;
    private readonly RETRY_WINDOW_MS;
    private checkRetryRateLimit;
    retry(tenantId: string, id: string): Promise<{
        success: boolean;
        messageId: string;
    }>;
    getStats(tenantId: string): Promise<{
        totalSent: number;
        totalPending: number;
        totalFailed: number;
        totalScheduled: number;
        byChannel: {
            email: number;
            whatsapp: number;
            sms: number;
        };
        recentActivity: {
            subject: string | null;
            id: string;
            createdAt: Date;
            status: import("@prisma/client").$Enums.MessageStatus;
            channel: import("@prisma/client").$Enums.Channel;
            recipientEmail: string | null;
        }[];
    }>;
    private resolveRecipient;
}
